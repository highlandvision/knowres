stripe=Stripe(document.getElementById("stripe-key").dataset.key);let pt,elements;async function initializeStripe(){var{clientSecret,paymentType}=await fetch("index.php?option=com_knowres&task=service.stripecreate",{method:"POST",headers:{"Content-Type":"application/json"}}).then(r=>r.json());pt=paymentType;(elements=stripe.elements({clientSecret:clientSecret})).create("payment",{layout:"tabs"}).mount("#payment-element")}async function handleSubmit(e){e.preventDefault(),setLoading(!0);e="https://"+window.location.hostname+"/index.php?option=com_knowres&task=service.stripecomplete";if("OBR"===pt){let{}=await stripe.confirmSetup({elements:elements,confirmParams:{return_url:e}})}else{let{}=await stripe.confirmPayment({elements:elements,confirmParams:{return_url:e}})}"card_error"===error.type||"validation_error"===error.type?showMessage(error.message):showMessage("Sorry an unexpected error has occurred. Please check your details. If the error continues please contact us for help."),setLoading(!1)}async function checkStatus(){let clientSecret;if(clientSecret="OBR"===pt?new URLSearchParams(window.location.search).get("setup_intent_client_secret"):new URLSearchParams(window.location.search).get("payment_intent_client_secret"))if("OBR"===pt){var setupIntent=(await stripe.retrieveSetupIntent(clientSecret)).setupIntent;switch(setupIntent.status){case"succeeded":showMessage("Payment succeeded!");break;case"processing":showMessage("Your payment is processing.");break;case"requires_payment_method":showMessage("Your payment was not successful, please try again.");break;default:showMessage("Something went wrong.")}}else{setupIntent=(await stripe.retrievePaymentIntent(clientSecret)).paymentIntent;switch(setupIntent.status){case"succeeded":showMessage("Payment succeeded!");break;case"processing":showMessage("Your payment is processing.");break;case"requires_payment_method":showMessage("Your payment was not successful, please try again.");break;default:showMessage("Something went wrong.")}}}function showMessage(messageText){let messageContainer=document.querySelector("#payment-message");messageContainer.classList.remove("hidden"),messageContainer.textContent=messageText,setTimeout(function(){messageContainer.classList.add("hidden"),messageContainer.textContent=""},4e3)}function setLoading(isLoading){isLoading?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}initializeStripe(),checkStatus(),document.querySelector("#kr-form-gateway").addEventListener("submit",handleSubmit);