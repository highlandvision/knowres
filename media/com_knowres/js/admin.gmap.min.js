!function($){let myGmap,map;class Krgmap{constructor(element,options){this.settings={lat:"",lng:"",maxZoom:20,zoom:10},options&&$.extend(this.settings,options),this.element=element,this.settings.lat&&this.settings.lng&&this.initMap()}initMap(){let point=new google.maps.LatLng(this.settings.lat,this.settings.lng,this.settings.zoom);var mapoptions={center:point,zoom:this.settings.zoom,maxZoom:this.settings.maxZoom,mapTypeId:"roadmap"};map=new google.maps.Map(document.getElementById("mapdrag"),mapoptions);let marker=new google.maps.Marker({position:point,draggable:!0});marker.setMap(map),this.updateMarkerPosition(point.lat(),point.lng()),google.maps.event.addListener(marker,"dragend",()=>{let newpoint=marker.getPosition();this.updateMarkerPosition(newpoint.lat(),newpoint.lng()),map.setCenter(newpoint)})}refreshMap(lat,lng,maxzoom){lat&&(this.settings.lat=lat),lng&&(this.settings.lng=lng),maxzoom&&(this.settings.maxZoom=parseInt(maxzoom)),this.initMap()}updateMarkerPosition(lat,lng){$("#jform_lat").val(lat.toFixed(5)),$("#jform_lng").val(lng.toFixed(5))}}$(function(){const $drag=$("#mapdrag");var params;$drag.length&&(params={lat:$drag.data("lat"),lng:$drag.data("lng"),zoom:$drag.data("zoom"),maxZoom:$drag.data("maxzoom")},myGmap=new Krgmap($drag,params)),$("#jform_map_max_zoom").on("change",function(e){e.preventDefault(),myGmap.refreshMap(!1,!1,$(this).val())}),$("a#geocodeAddress").on("click",function(e){e.preventDefault();e=$("#jform_property_street").val()+", "+$("#jform_town_id").find(":selected").text()+" "+$("#jform_property_postcode").val()+", "+$("#jform_region_id").find(":selected").text()+" "+$("#jform_country_id").find(":selected").text();let coord=[];$.ajax({type:"POST",url:"index.php?option=com_knowres&task=property.geocode",data:{address:e},dataType:"json",success:function(jsondata){$.each(jsondata,function(key,value){$("#"+key).val(value),coord[key]=value,myGmap.refreshMap(coord.lat,coord.lng,!1)})}})})})}(jQuery);